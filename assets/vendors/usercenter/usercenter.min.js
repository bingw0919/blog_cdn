document.addEventListener("DOMContentLoaded", function() {
  const tabContainer = document.querySelector(".bearui_config__aside .tabs");
  const noticePanel = document.querySelector(".bearui_config__notice");
  const userForm = document.querySelector("#user-form");
  const contentPanels = document.querySelectorAll(".bearui_content");
 
  function initUI() {
    const savedTab = sessionStorage.getItem("bearui_config_current");
    
    if (savedTab) {
      activateTab(savedTab);
      showPanel(savedTab === "bearui_notice" ? noticePanel : userForm);
      showContentPanel(savedTab);
    } else {
      activateFirstTab();
      showPanel(noticePanel);
    }
  }

  function activateTab(tabId) {
    document.querySelectorAll(".bearui_config__aside .item").forEach(tab => {
      tab.classList.toggle("active", tab.dataset.current === tabId);
    });
  }

  function activateFirstTab() {
    const firstTab = document.querySelector(".bearui_config__aside .item");
    if (firstTab) {
      firstTab.classList.add("active");
      sessionStorage.setItem("bearui_config_current", firstTab.dataset.current);
    }
  }

  function showPanel(panel) {
    if (panel === noticePanel) {
      noticePanel.style.display = "block";
      userForm.style.display = "none";
    } else {
      noticePanel.style.display = "none";
      userForm.style.display = "block";
    }
  }

  function showContentPanel(panelId) {
    contentPanels.forEach(panel => {
      panel.style.display = panel.classList.contains(panelId) ? "block" : "none";
    });
  }

  function handleTabClick(event) {
    const tab = event.target.closest(".item");
    if (!tab || !tabContainer.contains(tab)) return;
    
    const tabId = tab.dataset.current;

    activateTab(tabId);
    sessionStorage.setItem("bearui_config_current", tabId);

    if (tabId === "bearui_notice") {
      showPanel(noticePanel);
    } else {
      showPanel(userForm);
      showContentPanel(tabId);
    }
  }

  tabContainer.addEventListener("click", handleTabClick);

  initUI();
});
